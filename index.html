<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>เครื่องคำนวณ Echoes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
  <div class="card shadow">
    <div class="card-body">
      <h2 class="card-title text-center mb-4">เครื่องคำนวณแพ็กเกจ Echoes</h2>

      <div class="mb-3">
        <label for="modeSelect" class="form-label">เลือกโหมดคำนวณ</label>
        <select id="modeSelect" class="form-select">
          <option value="buttons">คำนวณจากจำนวนกระดุม</option>
          <option value="topup">คำนวณจากยอดเติมเสียงสะท้อน</option>
          <option value="budget">คำนวณจากงบประมาณ</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="echoesInput" class="form-label">จำนวนที่ต้องการ (กระดุม / ยอดเติม / งบ)</label>
        <input type="number" id="echoesInput" class="form-control" placeholder="เช่น 833 หรือ 1759 หรือ 1000">
      </div>
      <button class="btn btn-primary w-100" onclick="calculate()">คำนวณ</button>

      <div class="mt-4">
        <h5>ผลลัพธ์:</h5>
        <div id="result" class="bg-white p-3 border rounded"></div>
      </div>
    </div>
  </div>
</div>

<script>
  const echoTopup = { 66: 60, 203: 185, 335: 305, 759: 690 };
  const prices = { 66: 30, 203: 85, 335: 140, 759: 280 };

  function getBigPackPrice(count) {
    if (count > 25) return 275;
    if (count > 15) return 278;
    return 280;
  }

  // ฟังก์ชันลองทุกชุดแพ็กเล็กตามกฎ
  function trySmallPacks(target, mode="buttons") {
    let options = [];
    for (let c66=0;c66<=2;c66++) {
      for (let c203=0;c203<=1;c203++) {
        for (let c335=0;c335<=1;c335++) {
          let echoes = c66*66 + c203*203 + c335*335;
          let topup = c66*echoTopup[66] + c203*echoTopup[203] + c335*echoTopup[335];
          let price = c66*prices[66] + c203*prices[203] + c335*prices[335];
          if (mode==="buttons" && echoes>=target) {
            options.push({echoes,topup,price,packs:{c66,c203,c335}});
          }
          if (mode==="topup" && topup>=target) {
            options.push({echoes,topup,price,packs:{c66,c203,c335}});
          }
        }
      }
    }
    options.sort((a,b)=>a.price-b.price);
    return options[0]||null;
  }

  // โหมด 1: คำนวณจากจำนวนกระดุม
  function calculateButtons() {
    let needed = parseInt(document.getElementById("echoesInput").value);
    if (isNaN(needed) || needed <= 0) {
      document.getElementById("result").innerText = "กรุณากรอกจำนวนกระดุมที่ถูกต้อง";
      return;
    }
    let bigCount = Math.floor(needed/759);
    let bigPrice = getBigPackPrice(bigCount);
    let totalPrice = bigCount*bigPrice;
    let totalEchoes = bigCount*759;
    let totalTopup = bigCount*echoTopup[759];

    let remaining = needed-totalEchoes;
    let fill = remaining>0?trySmallPacks(remaining,"buttons"):null;
    if (fill) {
      totalPrice+=fill.price;
      totalEchoes+=fill.echoes;
      totalTopup+=fill.topup;
    }
    if (totalEchoes<needed) {
      bigCount+=1;
      let extraPrice=getBigPackPrice(bigCount);
      totalPrice+=extraPrice;
      totalEchoes+=759;
      totalTopup+=echoTopup[759];
    }
    document.getElementById("result").innerHTML=`<p>รวมทั้งหมด: ${totalEchoes} กระดุม</p><p>ราคารวม: ${totalPrice} บาท</p><p>ยอดเติมเสียงสะท้อนรวม: ${totalTopup}</p>`;
  }

  // โหมด 2: คำนวณจากยอดเติมเสียงสะท้อน
  function calculateTopup() {
    let neededTopup = parseInt(document.getElementById("echoesInput").value);
    if (isNaN(neededTopup) || neededTopup <= 0) {
      document.getElementById("result").innerText = "กรุณากรอกยอดเติมเสียงสะท้อนที่ถูกต้อง";
      return;
    }
    let bigCount = Math.floor(neededTopup/echoTopup[759]);
    let bigPrice = getBigPackPrice(bigCount);
    let totalPrice = bigCount*bigPrice;
    let totalEchoes = bigCount*759;
    let totalTopup = bigCount*echoTopup[759];

    let remaining = neededTopup-totalTopup;
    let fill = remaining>0?trySmallPacks(remaining,"topup"):null;
    if (fill) {
      totalPrice+=fill.price;
      totalEchoes+=fill.echoes;
      totalTopup+=fill.topup;
    }
    if (totalTopup<neededTopup) {
      bigCount+=1;
      let extraPrice=getBigPackPrice(bigCount);
      totalPrice+=extraPrice;
      totalEchoes+=759;
      totalTopup+=echoTopup[759];
    }
    document.getElementById("result").innerHTML=`<p>รวมทั้งหมด: ${totalEchoes} กระดุม</p><p>ราคารวม: ${totalPrice} บาท</p><p>ยอดเติมเสียงสะท้อนรวม: ${totalTopup}</p>`;
  }

  // โหมด 3: คำนวณจากงบประมาณ
  function calculateBudget() {
    let budget = parseInt(document.getElementById("echoesInput").value);
    if (isNaN(budget) || budget <= 0) {
      document.getElementById("result").innerText = "กรุณากรอกงบประมาณที่ถูกต้อง";
      return;
    }
    let options=[];
    for (let c66=0;c66<=2;c66++) {
      for (let c203=0;c203<=1;c203++) {
        for (let c335=0;c335<=1;c335++) {
          for (let c759=0;c759<=10;c759++) {
            let price=c66*prices[66]+c203*prices[203]+c335*prices[335]+c759*prices[759];
            let desc=`${c759>0?`759 x ${c759} `:""}${c335>0?`+ 335 x ${c335} `:""}${c203>0?`+ 203 x ${c203} `:""}${c66>0?`+ 66 x ${c66}`:""}`;
            if(desc==="") continue;
            options.push({desc:desc.trim(),price});
          }
        }
      }
    }
    let lower=options.filter(o=>o.price<budget
