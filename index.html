<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>เครื่องคำนวณ Echoes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
  <div class="card shadow">
    <div class="card-body">
      <h2 class="card-title text-center mb-4">เครื่องคำนวณแพ็กเกจ Echoes</h2>

      <div class="mb-3">
        <label for="modeSelect" class="form-label">เลือกโหมดคำนวณ</label>
        <select id="modeSelect" class="form-select">
          <option value="buttons">คำนวณจากจำนวนกระดุม</option>
          <option value="topup">คำนวณจากยอดเติมเสียงสะท้อน</option>
          <option value="budget">คำนวณจากงบประมาณ</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="echoesInput" class="form-label">จำนวนที่ต้องการ (กระดุม / ยอดเติม / งบ)</label>
        <input type="number" id="echoesInput" class="form-control" placeholder="เช่น 833 หรือ 1759 หรือ 1000">
      </div>
      <button class="btn btn-primary w-100" onclick="calculate()">คำนวณ</button>

      <div class="mt-4">
        <h5>ผลลัพธ์:</h5>
        <div id="result" class="bg-white p-3 border rounded"></div>
      </div>
    </div>
  </div>
</div>

<script>
  const echoTopup = { 66: 60, 203: 185, 335: 305, 759: 690 };
  const prices = { 66: 30, 203: 85, 335: 140, 759: 280 };

  function getBigPackPrice(count) {
    if (count > 25) return 275;
    if (count > 15) return 278;
    return 280;
  }

  // โหมด 1: คำนวณจากจำนวนกระดุม
  function calculateButtons() {
    let needed = parseInt(document.getElementById("echoesInput").value);
    if (isNaN(needed) || needed <= 0) {
      document.getElementById("result").innerText = "กรุณากรอกจำนวนกระดุมที่ถูกต้อง";
      return;
    }
    // ใช้สูตรเดิม: 759 เป็นหลัก + เติมแพ็กเล็กตามกฎ
    let bigCount = Math.floor(needed / 759);
    let bigPrice = getBigPackPrice(bigCount);
    let totalPrice = bigCount * bigPrice;
    let totalEchoes = bigCount * 759;
    let totalTopup = bigCount * echoTopup[759];

    // ถ้ายังไม่ถึง → ปัดขึ้นไปใช้แพ็กใหญ่
    if (totalEchoes < needed) {
      bigCount += 1;
      let extraPrice = getBigPackPrice(bigCount);
      totalPrice += extraPrice;
      totalEchoes += 759;
      totalTopup += echoTopup[759];
    }

    document.getElementById("result").innerHTML = `
      <p><strong>รวมทั้งหมด:</strong> ${totalEchoes} กระดุม</p>
      <p><strong>ราคารวม:</strong> ${totalPrice} บาท</p>
      <p><strong>ยอดเติมเสียงสะท้อนรวม:</strong> ${totalTopup}</p>
    `;
  }

  // โหมด 2: คำนวณจากยอดเติมเสียงสะท้อน
  function calculateTopup() {
    let neededTopup = parseInt(document.getElementById("echoesInput").value);
    if (isNaN(neededTopup) || neededTopup <= 0) {
      document.getElementById("result").innerText = "กรุณากรอกยอดเติมเสียงสะท้อนที่ถูกต้อง";
      return;
    }
    let bigCount = Math.floor(neededTopup / echoTopup[759]);
    let bigPrice = getBigPackPrice(bigCount);
    let totalPrice = bigCount * bigPrice;
    let totalEchoes = bigCount * 759;
    let totalTopup = bigCount * echoTopup[759];

    // ถ้ายังไม่ถึง → ปัดขึ้นไปใช้แพ็กใหญ่
    if (totalTopup < neededTopup) {
      bigCount += 1;
      let extraPrice = getBigPackPrice(bigCount);
      totalPrice += extraPrice;
      totalEchoes += 759;
      totalTopup += echoTopup[759];
    }

    document.getElementById("result").innerHTML = `
      <p><strong>รวมทั้งหมด:</strong> ${totalEchoes} กระดุม</p>
      <p><strong>ราคารวม:</strong> ${totalPrice} บาท</p>
      <p><strong>ยอดเติมเสียงสะท้อนรวม:</strong> ${totalTopup}</p>
    `;
  }

  // โหมด 3: คำนวณจากงบประมาณ
  function calculateBudget() {
    let budget = parseInt(document.getElementById("echoesInput").value);
    if (isNaN(budget) || budget <= 0) {
      document.getElementById("result").innerText = "กรุณากรอกงบประมาณที่ถูกต้อง";
      return;
    }

    let options = [];
    // ลองทั้งแพ็กใหญ่และแพ็กเล็ก
    [66,203,335,759].forEach(pack=>{
      options.push({desc:`${pack} x 1`, price:prices[pack]});
    });
    for (let count = 1; count <= 20; count++) {
      let price = getBigPackPrice(count) * count;
      options.push({desc:`759 x ${count}`, price});
      options.push({desc:`759 x ${count} + 335`, price: price + prices[335]});
    }

    let lower = options.filter(o => o.price < budget).sort((a,b)=>budget-b.price-budget+a.price)[0];
    let equal = options.reduce((best,o)=>Math.abs(o.price-budget)<Math.abs((best?.price||0)-budget)?o:best,null);
    let higher = options.filter(o => o.price > budget).sort((a,b)=>a.price-budget-(b.price-budget))[0];

    let html = "<table class='table table-bordered'><thead><tr><th>ตัวเลือก</th><th>ราคา</th></tr></thead><tbody>";
    if (lower) html += `<tr><td>ต่ำกว่า: ${lower.desc}</td><td>${lower.price} บาท</td></tr>`;
    if (equal) html += `<tr><td>ใกล้เคียง/เท่ากับ: ${equal.desc}</td><td>${equal.price} บาท</td></tr>`;
    if (higher) html += `<tr><td>สูงกว่าเล็กน้อย: ${higher.desc}</td><td>${higher.price} บาท</td></tr>`;
    html += "</tbody></table>";

    document.getElementById("result").innerHTML = html;
  }

  function calculate() {
    let mode = document.getElementById("modeSelect").value;
    if (mode === "buttons") {
      calculateButtons();
    } else if (mode === "topup") {
      calculateTopup();
    } else {
      calculateBudget();
    }
  }
</script>

</body>
</html>
