<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>เครื่องคำนวณ Echoes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
  <div class="card shadow">
    <div class="card-body">
      <h2 class="card-title text-center mb-4">เครื่องคำนวณแพ็กเกจ Echoes</h2>

      <div class="mb-3">
        <label for="modeSelect" class="form-label">เลือกโหมดคำนวณ</label>
        <select id="modeSelect" class="form-select">
          <option value="buttons">คำนวณจากจำนวนกระดุม</option>
          <option value="topup">คำนวณจากยอดเติมเสียงสะท้อน</option>
          <option value="budget">คำนวณจากงบประมาณ</option>
          <option value="discount">คำนวณแบบใช้ส่วนลด</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="echoesInput" class="form-label">จำนวนที่ต้องการ (กระดุม / ยอดเติม / งบ)</label>
        <input type="number" id="echoesInput" class="form-control" placeholder="เช่น 833 หรือ 1759 หรือ 1000">
      </div>

      <!-- ช่องกรอกส่วนลด -->
      <div class="mb-3">
        <label for="discount3" class="form-label">จำนวนสิทธิ์ส่วนลด 3%</label>
        <input type="number" id="discount3" class="form-control" value="0">
      </div>
      <div class="mb-3">
        <label for="discount10" class="form-label">จำนวนสิทธิ์ส่วนลด 10%</label>
        <input type="number" id="discount10" class="form-control" value="0">
      </div>

      <!-- ช่องเลือกแพ็กที่จะใช้ส่วนลด -->
      <div class="mb-3">
        <label class="form-label">เลือกแพ็กที่จะใช้ส่วนลด</label><br>
        <input type="checkbox" id="pack66" value="66"> 66 กระดุม<br>
        <input type="checkbox" id="pack203" value="203"> 203 กระดุม<br>
        <input type="checkbox" id="pack335" value="335"> 335 กระดุม<br>
        <input type="checkbox" id="pack759" value="759"> 759 กระดุม<br>
        <input type="checkbox" id="pack2227" value="2227"> 2227 กระดุม<br>
        <input type="checkbox" id="pack3663" value="3663"> 3663 กระดุม<br>
        <input type="checkbox" id="pack7249" value="7249"> 7249 กระดุม<br>
      </div>

      <button class="btn btn-primary w-100" onclick="calculate()">คำนวณ</button>

      <div class="mt-4">
        <h5>ผลลัพธ์:</h5>
        <div id="result" class="bg-white p-3 border rounded"></div>
      </div>
    </div>
  </div>
</div>

<script>
  const echoTopup = { 66: 60, 203: 185, 335: 305, 759: 690, 2227: 2000, 3663: 3300, 7249: 6600 };
  const prices = { 66: 30, 203: 85, 335: 140, 759: 280, 2227: 820, 3663: 1360, 7249: 2620 };

  // ตารางราคาส่วนลด
  const discountTable = {
    66: {p3:29, p10:27},
    203: {p3:82, p10:77},
    335: {p3:135, p10:125},
    759: {p3:272, p10:252},
    2227: {p3:820, p10:760},
    3663: {p3:1360, p10:1260},
    7249: {p3:2620, p10:2430}
  };

  function getDiscountedPrice(pack, basePrice) {
    let discount3 = parseInt(document.getElementById("discount3").value) || 0;
    let discount10 = parseInt(document.getElementById("discount10").value) || 0;

    if (document.getElementById("pack"+pack).checked) {
      if (discount10 > 0) {
        document.getElementById("discount10").value = discount10 - 1;
        return discountTable[pack].p10;
      } else if (discount3 > 0) {
        document.getElementById("discount3").value = discount3 - 1;
        return discountTable[pack].p3;
      }
    }
    return basePrice;
  }

  function calculateDiscount() {
    let packs = [66,203,335,759,2227,3663,7249];
    let totalPrice = 0, totalEchoes = 0, totalTopup = 0, totalPacks = 0;
    let rows = "";

    packs.forEach(pack=>{
      if (document.getElementById("pack"+pack).checked) {
        let basePrice = prices[pack];
        let finalPrice = getDiscountedPrice(pack, basePrice);
        totalPrice += finalPrice;
        totalEchoes += pack;
        totalTopup += echoTopup[pack];
        totalPacks += 1;
        rows += `<tr><td>${pack}</td><td>${basePrice}</td><td>${finalPrice}</td></tr>`;
      }
    });

    let html = "<table class='table table-bordered'><thead><tr><th>แพ็ก</th><th>ราคาปกติ</th><th>ราคาหลังส่วนลด</th></tr></thead><tbody>";
    html += rows + "</tbody></table>";
    html += `<p>รวมราคา: ${totalPrice} บาท</p>`;
    html += `<p>กระดุมรวม: ${totalEchoes}</p>`;
    html += `<p>ยอดเติมเสียงสะท้อนรวม: ${totalTopup}</p>`;
    html += `<p>จำนวนสิทธิ์สุ่มที่ได้: ${totalPacks}</p>`;
    document.getElementById("result").innerHTML = html;
  }

  // ฟังก์ชันเดิม (buttons, topup, budget) คงไว้เหมือนที่คุณมี
  // ... [โค้ด generateOptions, calculateButtons, calculateTopup, calculateBudget เหมือนเดิม] ...

  function calculate() {
    let mode = document.getElementById("modeSelect").value;
    if (mode === "buttons") {
      calculateButtons();
    } else if (mode === "topup") {
      calculateTopup();
    } else if (mode === "budget") {
      calculateBudget();
    } else {
      calculateDiscount();
    }
  }
</script>

</body>
</html>
